---
import ProjectCard from "./ProjectCard.astro";
import { fetchRepos, fetchLanguages } from "../utils/github";

const username = "jonathon-hackbarth";
const token = import.meta.env.GITHUB_TOKEN;

let projects = [];
try {
  const repos = await fetchRepos(username, token);
  projects = await Promise.all(
    repos.map(async (repo) => {
      const languages = await fetchLanguages(repo.languages_url, token);
      const totalBytes = Object.values(languages).reduce((acc, bytes) => acc + bytes, 0);
      const languagePercentages = Object.entries(languages).map(([lang, bytes]) => ({
        name: lang,
        percentage: ((bytes / totalBytes) * 100).toFixed(1),
      }));

      return {
        ...repo,
        languages: languagePercentages,
      };
    })
  );
} catch (error) {
  console.error("Error fetching GitHub data:", error);
}
---

<section id="projects" class="py-16">
  <h2>Recent Projects</h2>
  <div class="project-list">
    {projects.map((project) => (
      <ProjectCard {...project} />
    ))}
  </div>
</section>

<style>
  .projects {
    padding: 4rem 2rem; /* Increased vertical padding */
  }

  .project-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  @media (min-width: 1024px) {
    .project-list {
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    }
  }

  h2 {
    text-align: center;
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 3rem;
  }
</style>